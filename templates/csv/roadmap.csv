{% set g = namespace( comma = '', roadmap_items = ['milestones','deliverables','objectives','keyresults','todos']) -%}
type, _id, id, requirement, state, title, date, description, reference.name, reference.link, _has_todos
{#- we have 3 levels and have to iterate 3 times -#}
{%- for object_identifier in g.roadmap_items %}
{%- if object_identifier in project -%}
{%- for item in project[object_identifier] %}
{{ object_identifier -}}
    {%- set g.comma = ', ' -%}
    {{- g.comma -}}
    {{- item._id -}}
    {{- g.comma -}}
    {{- item.id -}}
    {{- g.comma -}}
    {{- item.requirement if "requirement" in item else " " -}}
    {{- g.comma -}}
    {{- item.state if "state" in item else " " -}}
    {{- g.comma -}}
    "{{- item.title if "title" in item else " " -}}"
    {{- g.comma -}}
    "{{- item.date if "date" in item else " " -}}"
    {{- g.comma -}}
    "{{ (item.description | replace('\n', '\\n') ) if "description" in item else " " -}}"
    {{- g.comma -}}
    "{{- item.reference.name if "reference" in item else " " -}}"
    {{- g.comma -}}
    "{{- item.reference.link if "reference" in item else " " -}}"
    {{- g.comma -}}
    "{{- item.todos| length if "todos" in item else 0 -}}"
    {%- set g.comma = '' -%}
    {{ g.comma }}
{%- for subobject_identifier in g.roadmap_items %}
{%- if subobject_identifier in item -%}
{%- for subitem in item[subobject_identifier] %}
{{ object_identifier }}.{{ subobject_identifier -}}
    {%- set g.comma = ', ' -%}
    {{- g.comma -}}
    {{- subitem._id -}}
    {{- g.comma -}}
    {{- subitem.id -}}
    {{- g.comma -}}
    {{- subitem.requirement if "requirement" in subitem else " " -}}
    {{- g.comma -}}
    {{- subitem.state if "state" in subitem else " " -}}
    {{- g.comma -}}
    "{{- subitem.title if "title" in subitem else " " -}}"
    {{- g.comma -}}
    "{{- subitem.date if "date" in subitem else " " -}}"
    {{- g.comma -}}
    "{{ (subitem.description | replace('\n', '\\n') ) if "description" in subitem else " " -}}"
    {{- g.comma -}}
    "{{- subitem.reference.name if "reference" in subitem else " " -}}"
    {{- g.comma -}}
    "{{- subitem.reference.link if "reference" in subitem else " " -}}"
    {{- g.comma -}}
    "{{- subitem.todos| length if "todos" in subitem else 0 -}}"
    {%- set g.comma = '' -%}
    {{ g.comma }}
{%- for sub_subobject_identifier in g.roadmap_items %}
{%- if sub_subobject_identifier in subitem -%}
{%- for sub_subitem in subitem[sub_subobject_identifier] %}
{{ object_identifier }}.{{ subobject_identifier }}.{{ sub_subobject_identifier -}}
    {%- set g.comma = ', ' -%}
    {{- g.comma -}}
    {{- sub_subitem._id -}}
    {{- g.comma -}}
    {{- sub_subitem.id -}}
    {{- g.comma -}}
    {{- sub_subitem.requirement if "requirement" in sub_subitem else " " -}}
    {{- g.comma -}}
    {{- sub_subitem.state if "state" in sub_subitem else " " -}}
    {{- g.comma -}}
    "{{- sub_subitem.title if "title" in sub_subitem else " " -}}"
    {{- g.comma -}}
    "{{- sub_subitem.date if "date" in sub_subitem else " " -}}"
    {{- g.comma -}}
    "{{ (sub_subitem.description | replace('\n', '\\n') ) if "description" in sub_subitem else " " -}}"
    {{- g.comma -}}
    "{{- sub_subitem.reference.name if "reference" in sub_subitem else " " -}}"
    {{- g.comma -}}
    "{{- sub_subitem.reference.link if "reference" in sub_subitem else " " -}}"
    {{- g.comma -}}
    "{{- sub_subitem.todos| length if "todos" in sub_subitem else 0 -}}"
    {%- set g.comma = '' -%}
    {{ g.comma }}
{%- endfor %}
{%- endif %}
{%- endfor %}
{%- endfor %}
{%- endif %}
{%- endfor %}
{%- endfor %}
{%- endif %}
{%- endfor %}
